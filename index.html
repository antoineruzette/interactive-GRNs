<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Repressilator</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js"></script>
    <script>
        async function main() {
            // Load Pyodide
            let pyodide = await loadPyodide();
            await pyodide.loadPackage(['numpy', 'pandas', 'scipy', 'altair']);

            // Define and run Python code in the browser
            const pythonCode = `
import numpy as np
import pandas as pd
from scipy.integrate import solve_ivp
import altair as alt
from pyodide.http import pyfetch

# Define Repressilator
def repressilator_system(t, y, alpha, beta, n):
    A, B, C = y
    dA_dt = alpha / (1 + C**n) - beta * A
    dB_dt = alpha / (1 + A**n) - beta * B
    dC_dt = alpha / (1 + B**n) - beta * C
    return [dA_dt, dB_dt, dC_dt]

# Simulate repressilator
def simulate_repressilator(alpha, beta, n, A0, B0, C0, t_start=0, t_end=50, num_points=500):
    initial_conditions = [A0, B0, C0]
    t_eval = np.linspace(t_start, t_end, num_points)
    solution = solve_ivp(repressilator_system, [t_start, t_end], initial_conditions, args=(alpha, beta, n), t_eval=t_eval)
    return solution.t, solution.y

# Parameters
alpha, beta, n = 50, 1.0, 2
A0, B0, C0 = 0.0, 0.0, 0.0

# Simulate
t, y = simulate_repressilator(alpha, beta, n, A0, B0, C0)

# Prepare data for Altair
df = pd.DataFrame({
    'Time': t,
    'Protein A': y[0],
    'Protein B': y[1],
    'Protein C': y[2]
})

# Create Altair chart
chart = alt.Chart(df).mark_line().encode(
    x='Time',
    y='Protein A'
).properties(
    title='Protein A Concentration over Time'
)

chart.save('chart.json')
`;
            await pyodide.runPythonAsync(pythonCode);

            // Fetch and embed the Altair chart
            const response = await fetch('chart.json');
            const chartSpec = await response.json();
            vegaEmbed('#chart', chartSpec);
        }

        main();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
    <h1>Interactive Repressilator</h1>
    <div id="chart"></div>
</body>
</html>
